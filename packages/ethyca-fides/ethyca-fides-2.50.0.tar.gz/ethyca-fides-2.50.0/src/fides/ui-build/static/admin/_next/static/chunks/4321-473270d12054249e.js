"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4321],{54321:function(e,a,t){t.d(a,{Z:function(){return F}});var i=t(24246),s=t(93990),n=t(5152),r=t(27378),l=t(70810),d=t(60136),o=t(16781),c=t(31374),u=t(43073),m=t(34090),p=t(73269),x=t(37827),h=t(59389),y=t(9043),v=t(10284);let b=h.Ry().shape({data_categories:h.IX(h.Z_()).min(1,"Must assign at least one data category").label("Data categories"),data_use:h.Z_().required().label("Data use"),data_subjects:h.IX(h.Z_()).min(1,"Must assign at least one data subject").label("Data subjects")}),j={data_categories:[],data_subjects:[],data_use:"",dataset_references:[],customFieldValues:{},id:"",cookies:[]},g=e=>{var a;let{customFieldValues:t,...i}=e;return{...i,name:null!==(a=e.name)&&void 0!==a?a:"",cookies:i.cookies.map(e=>({name:e,path:"/"}))}},f=e=>{let{allDataUses:a,allDataCategories:t,allDataSubjects:s,allDatasets:r,privacyDeclarationId:l,includeCookies:d,includeCustomFields:o}=e,c=r?r.map(e=>{var a;return{label:null!==(a=e.name)&&void 0!==a?a:e.fides_key,value:e.fides_key}}):[];return(0,i.jsxs)(n.Kqy,{spacing:4,children:[(0,i.jsx)(y.AP,{id:"data_use",label:"Data use",name:"data_use",options:a.map(e=>({value:e.fides_key,label:e.fides_key})),tooltip:"What is the system using the data for. For example, is it for third party advertising or perhaps simply providing system operations.",variant:"stacked",singleValueBlock:!0,isDisabled:!!l}),(0,i.jsx)(y.j0,{id:"name",label:"Processing Activity",name:"name",variant:"stacked",tooltip:"The personal data processing activity or activities associated with this data use.",disabled:!!l}),(0,i.jsx)(y.AP,{name:"data_categories",label:"Data categories",options:t.map(e=>({value:e.fides_key,label:e.fides_key})),tooltip:"What type of data is your system processing? This could be various types of user or system data.",isMulti:!0,variant:"stacked",isDisabled:!0}),(0,i.jsx)(y.AP,{name:"data_subjects",label:"Data subjects",options:s.map(e=>({value:e.fides_key,label:e.fides_key})),tooltip:"Whose data are you processing? This could be customers, employees or any other type of user in your system.",isMulti:!0,variant:"stacked",isDisabled:!0}),d?(0,i.jsx)(y.VT,{name:"cookies",label:"Cookies",options:[],isMulti:!0,variant:"stacked",isClearable:!1}):null,r?(0,i.jsx)(y.AP,{name:"dataset_references",label:"Dataset references",options:c,tooltip:"Referenced Dataset fides keys used by the system.",isMulti:!0,variant:"stacked"}):null,o?(0,i.jsx)(x.uc,{resourceType:v.P6.PRIVACY_DECLARATION,resourceFidesKey:l}):null]})},_=(e,a)=>{var t,i;return e?{...e,customFieldValues:a||{},cookies:null!==(i=null===(t=e.cookies)||void 0===t?void 0:t.map(e=>e.name))&&void 0!==i?i:[]}:j},k=e=>{let{onSubmit:a,initialValues:t,allDataUses:s,privacyDeclarationId:l}=e,{customFieldValues:d,upsertCustomFields:o}=(0,x.mZ)({resourceType:v.P6.PRIVACY_DECLARATION,resourceFidesKey:l}),c=(0,r.useMemo)(()=>_(t,d),[t,d]),[u,m]=(0,r.useState)(!1),p=(0,r.useMemo)(()=>{let e=s.filter(e=>e.fides_key===c.data_use)[0];if(e)return c.name?"".concat(e.name," - ").concat(c.name):e.name},[s,c]);return{handleSubmit:async(e,t)=>{let{customFieldValues:i}=e,s=g(e),n=await a(s,t);if(n){let a=n.filter(a=>a.data_use===e.data_use&&(!a.name||a.name===e.name));a.length>0&&await o({customFieldValues:i,fides_key:a[0].id}),t.resetForm({values:e}),m(!0)}},renderHeader:e=>{let{dirty:a,boxProps:t,hideSaved:s}=e;return(0,i.jsxs)(n.xuv,{display:"flex",alignItems:"center",justifyContent:"space-between",...t,children:[p?(0,i.jsx)(n.X6q,{as:"h4",size:"xs",fontWeight:"medium",mr:4,children:p}):null,!s&&u&&!a&&c.data_use?(0,i.jsxs)(n.xvT,{fontSize:"sm","data-testid":"saved-indicator",children:[(0,i.jsx)(n.StI,{})," Saved"]}):null]})},initialValues:c}},D=e=>{let{onSubmit:a,initialValues:t,onDelete:s,...r}=e,{handleSubmit:l,renderHeader:d,initialValues:o}=k({onSubmit:a,initialValues:t,allDataUses:r.allDataUses,privacyDeclarationId:null==t?void 0:t.id});return(0,i.jsx)(m.J9,{enableReinitialize:!0,initialValues:o,onSubmit:l,validationSchema:b,children:e=>{let{dirty:a}=e;return(0,i.jsxs)(m.l0,{children:[(0,i.jsx)(p.Gt,{id:"PrivacyDeclaration",name:"New Privacy Declaration"}),(0,i.jsxs)(n.Kqy,{spacing:4,children:[(0,i.jsx)(n.xuv,{"data-testid":"header",children:d({dirty:a})}),(0,i.jsx)(f,{onDelete:s,...r})]})]})}})},w=e=>{let{privacyDeclaration:a,onEdit:t,onDelete:s,includeCustomFields:r,includeCookies:l,...d}=e,{initialValues:o,renderHeader:c,handleSubmit:u}=k({initialValues:a,onSubmit:e=>t(a,e),privacyDeclarationId:a.id,...d});return(0,i.jsx)(n.Qdk,{children:e=>{let{isExpanded:t}=e;return(0,i.jsx)(m.J9,{enableReinitialize:!0,initialValues:o,onSubmit:u,validationSchema:b,children:e=>{let{dirty:o}=e;return(0,i.jsxs)(m.l0,{"data-testid":"".concat(a.data_use,"-form"),children:[(0,i.jsx)(p.Gt,{id:"".concat(a.id,"-form"),name:a.id}),(0,i.jsxs)(n.KFZ,{py:4,borderBottomWidth:t?"0px":"1px",backgroundColor:t?"gray.50":void 0,"data-testid":"accordion-header-".concat(a.data_use),children:[c({dirty:o,boxProps:{flex:"1",textAlign:"left"},hideSaved:!t}),(0,i.jsx)(n.XEm,{})]}),(0,i.jsx)(n.Hk3,{backgroundColor:"gray.50",pt:0,children:(0,i.jsx)(n.Kqy,{spacing:4,children:(0,i.jsx)(f,{privacyDeclarationId:a.id,onDelete:s,includeCustomFields:r,includeCookies:l,...d})})})]})}})}})};var C=e=>{let{privacyDeclarations:a,...t}=e;return(0,i.jsx)(n.UQy,{allowToggle:!0,border:"transparent","data-testid":"privacy-declaration-accordion",children:a.map(e=>(0,i.jsx)(w,{privacyDeclaration:e,...t},e.id))})},S=e=>{let{system:a,includeCustomFields:t,includeCookies:s,onSave:l,...m}=e,p=(0,n.pmc)(),[x]=(0,c.qQ)(),[h,y]=(0,r.useState)(!1),[v,b]=(0,r.useState)(void 0),j=(0,r.useMemo)(()=>v?a.privacy_declarations.filter(e=>e.id!==v.id):a.privacy_declarations,[v,a]),g=e=>j.filter(a=>a.data_use===e.data_use&&a.name===e.name).length>0&&(p((0,o.Vo)("A declaration already exists with that data use in this system. Please supply a different data use.")),!0),f=async(e,t)=>{let i=e.map(e=>{var a;return{...e,name:null!==(a=e.name)&&void 0!==a?a:""}}),s={...a,privacy_declarations:i};return(e=>{if((0,u.D4)(e)){let a=(0,d.e$)(e.error,"An unexpected error occurred while updating the system. Please try again.");p((0,o.Vo)(a));return}return p.closeAll(),p((0,o.t5)(t?"Data use deleted":"Data use saved")),l&&l(e.data),e.data.privacy_declarations})(await x(s))},_=async(e,t)=>{if(!(t.id!==e.id&&g(t)))return f(a.privacy_declarations.map(a=>a.id===e.id?t:a))},k=async e=>{if(g(e))return;p.closeAll();let a=[...j,e],t=await f(a);return t&&b(t.filter(a=>(!a.name||a.name===e.name)&&a.data_use===e.data_use)[0]),t},w=async e=>f(a.privacy_declarations.filter(a=>a.id!==e.id),!0),S=async e=>{let a=await w(e);return a&&(y(!1),b(void 0)),a};return(0,r.useEffect)(()=>{y(!1)},[a.fides_key]),(0,i.jsxs)(n.Kqy,{spacing:3,children:[(0,i.jsx)(C,{privacyDeclarations:j,onEdit:_,onDelete:w,includeCustomFields:t,includeCookies:s,...m}),h?(0,i.jsx)(n.xuv,{backgroundColor:"gray.50",p:4,"data-testid":"new-declaration-form",children:(0,i.jsx)(D,{initialValues:v,onSubmit:k,onDelete:S,includeCustomFields:t,includeCookies:s,...m})}):null,0===a.privacy_declarations.length?(0,i.jsx)(n.xvT,{fontSize:"sm",lineHeight:5,fontWeight:"medium",pl:2,children:"No data uses"}):null]})},T=t(41164);let I=e=>{let[a]=(0,c.dB)(),t=(0,n.pmc)();return{handleUpsertSystem:async(i,s)=>{let n=[{...e,name:i.name,description:i.description}],r=await a(n);(0,T.D4)(r)?t((0,o.Vo)((0,d.e$)(r.error))):(t((0,o.t5)("Successfully saved system info")),s.resetForm({values:i}))},validationSchema:h.Ry().shape({name:h.Z_().required().label("Name"),description:h.Z_().required().label("Description")})}},V={name:"",description:""};var A=e=>{let{system:a}=e,t="/systems/configure/".concat(a.fides_key),{handleUpsertSystem:s,validationSchema:r}=I(a);return(0,i.jsxs)(n.xuv,{children:[(0,i.jsxs)(n.kCb,{alignItems:"center",children:[(0,i.jsx)(n.xvT,{color:"gray.600",size:"md",lineHeight:6,fontWeight:"semibold",marginBottom:2,children:"System details"}),(0,i.jsx)(n.LZC,{}),(0,i.jsxs)(n._pl,{color:"complimentary.500",href:t,children:["View more",(0,i.jsx)(n.h0n,{ml:2})]})]}),(0,i.jsx)(n.xuv,{width:"100%",padding:4,borderTop:"1px solid",borderColor:"gray.200",children:(0,i.jsx)(m.J9,{enableReinitialize:!0,initialValues:null!=a?a:V,validationSchema:r,onSubmit:s,children:e=>{let{isSubmitting:a,dirty:t,isValid:s}=e;return(0,i.jsxs)(m.l0,{children:[(0,i.jsx)(p.Gt,{id:"SystemInfoDrawer",name:"System Info"}),(0,i.jsx)(n.xuv,{marginTop:3,children:(0,i.jsx)(y.j0,{label:"System name",name:"name",variant:"stacked"})}),(0,i.jsx)(n.xuv,{marginTop:3,children:(0,i.jsx)(y.Ks,{label:"System description",name:"description",variant:"stacked"})}),(0,i.jsx)(n.kCb,{marginTop:6,justifyContent:"flex-end",children:(0,i.jsx)(n.wpx,{htmlType:"submit",disabled:!t||!s,loading:a,type:"primary",children:"Save"})})]})}})})]})},F=e=>{var a;let{selectedSystemId:t,resetSelectedSystemId:d}=e,o=(0,r.useMemo)(()=>!!t,[t]),{isLoading:u,...m}=(0,l.f)({includeDatasets:!1,includeDisabled:!1}),{data:p}=(0,c.rn)(t,{skip:!t});return(0,i.jsx)(n.xuv,{position:"absolute",pointerEvents:"none",top:0,left:0,right:0,bottom:0,overflow:"hidden",children:(0,i.jsx)(n.Mi4,{transition:{enter:{ease:"easeInOut",duration:.5},exit:{ease:"easeInOut",duration:.5}},direction:"right",in:o,unmountOnExit:!0,style:{zIndex:11,pointerEvents:"none",position:"absolute"},children:(0,i.jsxs)(n.xuv,{position:"absolute",right:"0px",height:"100%",width:"100%",maxWidth:"480px",pointerEvents:"auto",borderWidth:0,boxShadow:"0px 20px 25px -5px rgba(0, 0, 0, 0.1), 0px 10px 10px -5px rgba(0, 0, 0, 0.04)",display:t?"unset":"none",backgroundColor:"white","data-testid":"datamap-drawer",children:[(0,i.jsx)(n.xuv,{id:"drawer-header",borderBottomWidth:1,paddingX:6,paddingY:3,children:(0,i.jsxs)(n.kCb,{children:[(0,i.jsx)(n.kCb,{justifyContent:"space-between",alignItems:"center",height:"40px",children:(0,i.jsx)(n.xvT,{fontWeight:"semibold",fontSize:"lg",lineHeight:"7",color:"gray.900",children:null!==(a=null==p?void 0:p.name)&&void 0!==a?a:"System Information"})}),(0,i.jsx)(n.LZC,{}),(0,i.jsx)(n.kCb,{alignItems:"center",children:(0,i.jsx)(n.wpx,{icon:(0,i.jsx)(n.Two,{}),"aria-label":"Close error message",type:"text",onClick:d,"data-testid":"datamap-drawer-close"})})]})}),(0,i.jsx)(n.xuv,{id:"drawer-body",height:"calc(100% - 46px)",overflowY:"auto",padding:6,style:{scrollbarGutter:"stable"},children:p?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(A,{system:p}),(0,i.jsx)(n.xvT,{size:"md",color:"gray.600",lineHeight:6,fontWeight:"semibold",mt:"10px",mb:2,children:"Data uses"}),(0,i.jsx)(n.xuv,{borderTop:"1px solid",borderColor:"gray.200",children:(0,i.jsx)(n.xuv,{pb:3,children:(0,i.jsx)(S,{system:p,...m})})}),(0,i.jsx)(n.xvT,{size:"md",color:"gray.600",lineHeight:6,fontWeight:"semibold",mt:"10px",mb:2,paddingBottom:2,children:"Data flow"}),(0,i.jsx)(s.q,{system:p})]}):null})]})})})}}}]);